
#Workflow name
name: pull-request
on:
  #Manually trigger workflow runs
  workflow_dispatch:
  #Trigger the workflow on push from the main branch
  push: 
    branches:
      - a4
  pull_request:
    branches:
      - main
jobs:
  #Test's job
  tests:
   runs-on: ubuntu-latest
   name: Running tests
   steps:
     - uses: actions/checkout@v2
     - name: Set up JDK 17 
       uses: actions/setup-java@v1
       with:
          java-version: 17
     - name: Run unit tests
       run: |
          mvn -B package --file pom.xml
            cd target
            ls --all
            cp *.jar ami
            cd ..
            cd ami
            ls --all
     - name: Packer build
       uses: ExitoLab/packer_build_action_aws@v0.2.10
       with:
         templateFile: 'ami.json'
         workingDir: 'ami'
       env:
           AWS_ACCESS_KEY_ID: ${{secrets.AWS_ACCESS_KEY_ID }}
           AWS_SECRET_ACCESS_KEY: ${{secrets.AWS_SECRET_ACCESS_KEY }}
           AWS_DEFAULT_REGION: us-east-1
           GITHUB_REPO_PATH: ${{ github.workspace }}

#     name: Unit tests
#     #Run on Ubuntu using the latest version
#     runs-on: ubuntu-latest
#     #Job's steps
#     steps:
#       #Check-out your repository under $GITHUB_WORKSPACE, so your workflow can access it
#       - uses: actions/checkout@v2
#       #Set up JDK 17
#       - name: Set up JDK
#         uses: actions/setup-java@v1
#         with:
#           java-version: '17'
#       #Run Tests
#       - name: Run Tests
#         #run: mvn -B test
#         run: mvn verify
#     tests:
#       runs-on: ubuntu-latest
#       name: Running tests
#       needs: compile
#       steps:
#         - uses: actions/checkout@v2
#         - name: Set up JDK 1.8 
#           uses: actions/setup-java@v1
#           with:
#             java-version: 1.8
#         - name: Run unit tests
#           run: |
#             mvn -B package --file pom.xml
#             cd target
#             ls --all
#             cp *.jar ami
#             cd ..
#             cd ami
#             ls --all
#         - name: Packer build
#           uses: ExitoLab/packer_build_action_aws@v0.2.10
#           with:
#              templateFile: 'ami.json'
#              workingDir: 'ami'
#           env:
#            AWS_ACCESS_KEY_ID: ${{secrets.AWS_ACCESS_KEY_ID }}
#            AWS_SECRET_ACCESS_KEY: ${{secrets.AWS_SECRET_ACCESS_KEY }}
#            AWS_DEFAULT_REGION: us-east-1
